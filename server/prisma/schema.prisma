

// generate JavaScript to talk to the database
generator client {
  provider = "prisma-client-js"
}

// using PostgreSQL
// The URL comes from .env
datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// USER TABLE
// Everyone who creates an account — both providers and receivers
model User {
  id          String @id @default(uuid())  // unique ID auto-generated for each user
  email       String @unique               // no two accounts with same email
  name        String
  role        String                       // "provider" or "receiver"
  firebaseUid String @unique               // the ID Firebase gives each user on register

  // One user can have many listings and many reservations
  listings     FoodListing[]
  reservations Reservation[]
}

// FOOD LISTING TABLE
// Every food item a provider posts
model FoodListing {
  id            String   @id @default(uuid())
  foodName      String
  quantity      Int
  originalPrice Float                           // price set by provider 
  address       String                          // plain text e.g. "Guadalupe, Cebu"
  latitude      Float                           // for distance calculation
  longitude     Float                           // for distance calculation
  expiresAt     DateTime                        // when food expires 
  status        String   @default("available")  // "available", "reserved", "picked_up"
  createdAt     DateTime @default(now())        // when the listing was posted
  allowFree     Boolean  @default(true)         // can price drop to ₱0?
  minimumPrice  Float    @default(0)            // floor price when allowFree = false
  storageCondition  String   @default("room_temp")  // "room_temp", "refrigerated", "frozen"
  pickupWindowStart DateTime?                        // e.g. today at 3:00 PM
  pickupWindowEnd   DateTime?                        // e.g. today at 5:00 PM

  // Which provider posted this listing
  providerId   String
  provider     User          @relation(fields: [providerId], references: [id])
  reservations Reservation[]
}

// RESERVATION TABLE
// Created when a receiver reserves a food listing
model Reservation {
  id         String   @id @default(uuid())
  status     String   @default("pending")  // "pending" or "confirmed"
  reservedAt DateTime @default(now())

  // Which receiver made this reservation
  receiverId String
  receiver   User        @relation(fields: [receiverId], references: [id])

  // Which listing was reserved
  listingId  String      @unique           // one reservation per listing at a time
  listing    FoodListing @relation(fields: [listingId], references: [id])
}